#shell代码风格
##背景
1. 选择Shell

	必须使用Bash

		#!/bin/bash
	使用set设置Shell选项，限制运行环境，尽量使其能在所有机器上运行

	运行脚本方法：

		bash <脚本名称>

2. Shell的使用场合

	Shell只能用于小工具或者简单的封装脚本，不适合作为开发语言
	
	几点建议：
			
		* 经常调用其他小工具并且数据运算较少，可以选择Shell
		* 性能优先，不使用Shell
		* 使用数组，不能使用${PIPESTATUS}的，选择Python
		* 代码超过100行，建议使用Python

##Shell文件和解释器调用
1. 文件扩展名
	
	脚本无扩展名或使用.sh。
	
	库文件必须使用.sh，并且不可执行

2. SUID/SGID

	禁止使用SUID/SGID在任何的脚本

	必要时，使用sudo用于提升权限
##运行环境
1. 标准输入和标准错误输出：STDOUT vs STDERR
	
	所有的错误信息使用STDERR进行输出
	
	建议输出形式
	
		err(){
		  echo "[$(date +'%Y-%m-%dT%H:%M:%S%z')]:$@" >&2
		}

		if ! do_something;then
		  err "Unable to do do_something"
		  exit "${E_DID_NOTING}"
		fi
2. 注释
	
	文件开头对脚本内容进行注释

		#！/bin/bash
		#
		#脚本内容进行描述

	<b>函数注释</b>
	
	任何函数必须进行注释，除非很短或者功能很明显

	库函数必须进行注释，不论长度和复杂度

	函数的注释内容

		* 函数功能描述
		* 全局变量的使用和修改
		* 输入参数
		* 返回值 

		示例：
		#！bin/bash
		#
		#脚本内容描述
		
		export PATH='/usr/xpg4':/usr/bin:/opt/csw/bin:/opt/goog/bin'
		
		#######################################
		#Cleanup files from the backup dir
		#Globals:
		#  BACKUP_DIR
		#  ORACLE_SID
		#Arguements:
		#  None
		#Returns:
		#  None
		######################################
		cleanup(){
		  ...
		}

	<b>实现注释</b>

	难理解，不明显，有趣或者重要的代码部分
		
	不要注释所有，对复杂算法和难理解部分进行简短的注释

	<b>TODO注释</b>

	适用于临时代码、短期解决方案、性能良好但不完美的解决方案

	注释规则同C++

	注释形式如下：
				
		#TODO(用户名):功能注释（bug ###bugID）
		
##格式化
修改现有代码时遵循的风格

1. 缩进
	
	缩进两格，禁止使用Tab

	块与块之间采用空行间隔，提高可读性
	
	缩进两格

	不能使用Tab

	已有文件，对现有的缩进保持信任
2. 行长度和字符串长度
	
	最大行长度为80字节

	长度超过80时，可采用here或者一个新行

	文本字符串超过80且不适合分割时，可以，但最好找到简短的办法描述

3. 管道行命令
	
	如果一行写不完，就分割为每行一个命令

4. 循环
	
	;do 和;then 要和while，if，for放在同一行
		do {};then 
		  codeing 
		while

5. case
	
	缩进两格
	括号和选项的命令行之间要有一个空格
	长行和多行指令应该使用pattern actions 和;;分割为多行

	命令较短时，不影响可读性的前提下，可以将;;放在行末尾

6. 变量扩展

	与已知变量保持一致
	引用自己的变量
	尽量使用${var},具体看细节：单字节变量不使用括号包括。

7. 引用
	
	始终使用双引号进行引用
	尽量使用双引号引用单词，而不是路径和命令选项
	禁止引用数字整数
	注意使用[[的引用规则
	尽量使用"$@",除非有特别的原因，使用$*

## 功能和bugs

1. 变量替换

	使用$(command)，尽量不使用反引号

2. Test,[和[[

	使用[[,优于[,test,和/usr/bin/[

3. 测试字符串

	尽量使用""，而不是填充字符

4. 文件名的通配符扩展

	使用通配符进行匹配文件时，使用明确路径

5. eval

	避免使用eval

6. 输入到while的管道

	使用进程替换或者for循环代替

	在while循环中的修改变量时不会传递到父Shell中，因为while在子shell中运行

##命名约定

1. 函数名
	
	小写字母，使用下划线进行分割单词；不同库文件的的使用于域操作符::；函数名后必须跟括号。
2. 变量名

	同函数名的命名规则

3. 常量和环境变量名

	采用下划线进行分割，在文件的顶部进行声明

	常量和环境变量需要大写

4. 源文件名

	小写，下划线分割
	
5. 只读变量名

	使用readonly和declare -r 声明变量只读

6. 局部变量名

	使用local声明特定函数内的变量，声明和赋值在不同的行
	
	不会污染全局变量

7. 函数位置

	将函数放在常量的下方；函数之间不能出现可执行代码

8. 主函数

	长脚本中，需要一个命名为main的函数，函数内至少包含一个其他的函数

##调用命令
1. 检查返回值

	检验返回值，并给返回值附加信息

	非管道命令：使用$?或者if检查返回值

	管道命令采用PIPESTATUS检查返回值

	注意：PIPESTATUS会被下一条命令覆盖，如果需要错误信息，需要进行即时性的保存

2. 内建命令和外部命令

	在调用内建命令和外部命令时，选择则内建	

##结论
常识和保持一致性
C++编程规范
